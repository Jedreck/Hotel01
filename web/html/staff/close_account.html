<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <title>结算页面</title>

    <!-- Favicons -->
    <link href="../../img/favicon.png" rel="icon">
    <link href="../../img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Bootstrap core CSS -->
    <link href="../../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--external css-->
    <link href="../../lib/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../../css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="../../lib/gritter/css/jquery.gritter.css"/>
    <!-- Custom styles for this template -->
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/style-responsive.css" rel="stylesheet">
    <script src="../../lib/chart-master/Chart.js"></script>
    <script type="text/javascript" src="../../lib/layui/layui.all.js"></script>
    <link href="../../lib/layui/css/layui.css" rel="stylesheet" type="text/css"/>
    <script src="../../lib/jquery/jquery.js"></script>
    <script src="../../lib/layui/layui.js"></script>
    <!-- =======================================================
      Template Name: Dashio
      Template URL: https://templatemag.com/dashio-bootstrap-admin-template/
      Author: TemplateMag.com
      License: https://templatemag.com/license/
    ======================================================= -->
</head>

<body>
<section id="container">
    <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
        <div class="sidebar-toggle-box">
            <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
        </div>
        <!--logo start-->
        <a href="index.html" class="logo"><b>酒店<span>预订</span></b></a>
        <!--logo end-->
        <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
                <!-- settings start -->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                        <i class="fa fa-tasks"></i>
                        <div id="red_num">
                            <span class="badge bg-theme"></span>
                        </div>

                    </a>
                    <ul class="dropdown-menu extended tasks-bar">
                        <div class="notify-arrow notify-arrow-green"></div>
                        <li>
                            <p class="green">你有待接收的预定</p>
                        </li>
                        <li class="external">
                            <a href="/html/staff/unaccept_booking_orders.html">查看详情</a>
                        </li>
                    </ul>
                </li>
                <!-- settings end -->
            </ul>
            <!--  notification end -->
        </div>
        <div class="top-menu">
            <ul class="nav pull-right top-menu">
                <li><a class="logout" href="login.html">登出</a></li>
            </ul>
        </div>
    </header>
    <!--header end-->
    <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu" id="nav-accordion">
                <p class="centered"><a href="profile.html"><img src="../../img/ui-sam.jpg" class="img-circle" width="80"></a></p>
                <h5 class="centered">Sam Soffes</h5>

                <li class="mt">
                    <a class="active" href="#">
                        <i class="glyphicon glyphicon-home"></i>
                        <span>首页</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="glyphicon glyphicon-pencil"></i>
                        <span>预定订单管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="unaccept_booking_orders.html">待接受的订单</a></li>
                        <li><a href="accept_booking_orders.html">已接收的订单</a></li>
                    </ul>
                </li>


                <li class="sub-menu">
                    <a class="" href="#">
                        <i class="glyphicon glyphicon-time"></i>
                        <span>办理入住</span>
                    </a>
                    <ul class="sub">
                        <li><a href="check_in_now.html">网上未预定入住</a></li>
                        <li><a href="check_in_net.html">网上预定入住</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a class="" href="close_account.html">
                        <i class="glyphicon glyphicon-time"></i>
                        <span>结算</span>
                    </a>
                </li>
            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <hr/>
            <h3><i class="fa fa-user"></i>办理结算</h3>
            <hr style="height:10px;border:none;border-top:2px groove skyblue;"/>

            <!--房间列表-->
            <div class="row mt">
                <div class="col-md-12">
                    <div class="content-panel">
                        <h4><i class="fa fa-home"></i>详细订单</h4>
                        <hr/>
                        <div>
                            <div style="width: 700px;margin: 0px auto">

                                <!--表单-->
                                <form class="layui-form layui-form-pane" action="">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label" style="margin-left: 150px">手机号</label>
                                        <div class="layui-input-inline">
                                            <input name="title" class="layui-input" required="" type="text"
                                                   placeholder="请输入手机号" autocomplete="off" lay-verify="required"
                                                   id="phonenumber">
                                        </div>
                                        <button class="layui-btn layui-btn-primary" style="text-align: left"
                                                id="search_order_online" onclick="checkphonenumber()" type="button">查询
                                        </button>
                                    </div>
                                </form>
                                <!--表单-->

                                <table class="table table-striped table-advance table-hover">
                                    <tbody>
                                    <tr>
                                        <td style="width: 30%">
                                            <a href="basic_table.html#">订单号</a>
                                        </td>
                                        <td class="hidden-phone" id="order_number"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">预订人</a>
                                        </td>
                                        <td class="hidden-phone" id="order_people"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">人数</a>
                                        </td>
                                        <td class="hidden-phone" id="people_number"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">预订日期</a>
                                        </td>
                                        <td class="hidden-phone" id="checkindate"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">预计离店</a>
                                        </td>
                                        <td class="hidden-phone" id="checkoutdate"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">联系电话</a>
                                        </td>
                                        <td class="hidden-phone" id="phone_number"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">房型</a>
                                        </td>
                                        <td class="hidden-phone" id="roomtype"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">建筑面积</a>
                                        </td>
                                        <td class="hidden-phone" id="area"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">床型</a>
                                        </td>
                                        <td class="hidden-phone" id="bedtype"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">浴室</a>
                                        </td>
                                        <td class="hidden-phone" id="bathroom"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">有无无线网络</a>
                                        </td>
                                        <td class="hidden-phone" id="net"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">窗户</a>
                                        </td>
                                        <td class="hidden-phone" id="window"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">吸烟</a>
                                        </td>
                                        <td class="hidden-phone" id="somke"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">便利设施</a>
                                        </td>
                                        <td id="facility"></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="basic_table.html#">订单价格</a>
                                        </td>
                                        <td class="hidden-phone" id="price"></td>
                                    </tr>
                                    </tbody>

                                </table>

                                <div style="text-align: center">
                                    <button class="layui-btn layui-btn-primary" style="margin: auto auto"
                                            id="commit_order_online" onclick="checkout()">确定结算
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- /content-panel -->
                </div>
                <!-- /col-md-12 -->
            </div>
            <!--房间列表-->


            <!-- /row -->
        </section>
    </section>
    <!--main content end-->

    <!--footer start-->
    <footer class="site-footer">
        <div class="text-center">
            <p>
                &copy; Copyrights <strong>Dashio</strong>. All Rights Reserved
            </p>
            <div class="credits">
                <!--
                  You are NOT allowed to delete the credit link to TemplateMag with free version.
                  You can delete the credit link only if you bought the pro version.
                  Buy the pro version with working PHP/AJAX contact form: https://templatemag.com/dashio-bootstrap-admin-template/
                  Licensing information: https://templatemag.com/license/
                -->
                Created with Dashio template by <a href="https://templatemag.com/">TemplateMag</a>
            </div>
            <a href="index.html#" class="go-top">
                <i class="fa fa-angle-up"></i>
            </a>
        </div>
    </footer>
    <!--footer end-->
</section>


<!-- js placed at the end of the document so the pages load faster -->
<script src="../../lib/jquery/jquery.min.js"></script>

<script src="../../lib/bootstrap/js/bootstrap.min.js"></script>
<script class="include" type="text/javascript" src="../../lib/jquery.dcjqaccordion.2.7.js"></script>
<script src="../../lib/jquery.scrollTo.min.js"></script>
<script src="../../lib/jquery.nicescroll.js" type="text/javascript"></script>
<script src="../../lib/jquery.sparkline.js"></script>
<!--common script for all pages-->
<script src="../../lib/common-scripts.js"></script>
<script type="text/javascript" src="../../lib/gritter/js/jquery.gritter.js"></script>
<script type="text/javascript" src="../../lib/gritter-conf.js"></script>
<!--script for this page-->
<script src="../../lib/sparkline-chart.js"></script>
<script src="../../lib/zabuto_calendar.js"></script>
<script src="../../lib/layui/layui.all.js"></script>
<script src="../../lib/easyCookie.js"></script>
<script src="../../lib/my_common.js"></script>

<script>
    ;!function () {
        var layer = layui.layer, form = layui.form;
    }();
</script>

<script>
    layui.use('layer', function(){
        var layer = layui.layer;

    });
</script>

<script>

    window.onload = function () {
        getUnreadNumStaff();
    };

    $(function () {
        if(!validateEmployee()) return;
    });



    var index = 0;
    function checkphonenumber() {
        var result = true;
        var con;
        // 验证手机号
        var regPhone = /^1(3|4|5|7|8)\d{9}$/;
        phone = $("#phonenumber").val();
        result = regPhone.test(phone);
        if (!result) {
            layer.tips('请正确输入11位手机号', '#phonenumber', {
                tips: [2, '#cd2235'],
                time: 2000
            });
            return result;
        }else{
            var C_phone = $("#phonenumber").val();
            index = layer.load(0, {shade: false});
            console.log(C_phone);
            getData(C_phone)

        }
    }

    /**
     *
     * @param C_phone 获取的手机号
     */
    // 获取数据
    function getData(C_phone) {
        $.ajax({
            url: "/StaffCheckOutServlet",
            type:'post',
            data:{C_phone:C_phone},
            dataType:'text',
            success: function(data){
                var obj = JSON.parse(data);
                //
                // 后台查询失败
                if(obj == null) {
                    layer.close(index);
                    showResult("未查询出订单");
                    return;
                } else{
                    console.log(obj);
                    initialData(obj);
                }
            },
            error: function () {
                showResult("2出错，稍后重试！");
                window.history.back(-1);
                return;
            }
        });
    }
    // 数据初始化
    function initialData(obj) {
        var str = obj.checkintime.split(" ");
        var checkintime = str[0] + str[1] + str[2];
        str = obj.checkouttime.split(" ");
        var checkouttime = str[0] + str[1] + str[2];
        $("#order_number").text(obj.O_num);
        $("#order_people").text(obj.C_name);
        $("#people_number").text(obj.people);
        $("#checkindate").text(checkintime);
        $("#checkoutdate").text(checkouttime);
        $("#phone_number").text(obj.C_phone);
        $("#roomtype").text(obj.typename);
        $("#area").text(obj.area);
        $("#bedtype").text(obj.bedtype);
        $("#bathroom").text(obj.bathroom == 0?"没有":"有");
        $("#net").text(obj.wifi == 0?"没有":"有");
        $("#window").text(obj.windows == 0?"没有":"有");
        $("#somke").text(obj.smoke == 0?"不可以":"可以");
        $("#facility").text(obj.facility);
        $("#price").text(obj.price);
        layer.close(index);
    }
    // 显示插入的结果
    function showResult(content) {
        layer.open({
            content: content
            ,btn: ['确定']
            ,yes: function(index, layero){//删除
                layer.closeAll();
            }
            ,cancel: function(){
            }
        });
    }
    function checkout() {
        var order_number = $("#order_number").html();
        console.log(order_number);
        layer.open({
            content: '确定结算吗？'
            ,btn: ['确定', '再想想']
            ,yes: function(index, layero){//删除
                check(order_number);
                layer.closeAll();
            }
            ,btn2: function(index, layero){
                //按钮【按钮二】的回调

                //return false 开启该代码可禁止点击该按钮关闭
            }
            ,cancel: function(){
                //右上角关闭回调

                //return false 开启该代码可禁止点击该按钮关闭
            }
        });
    }

    function check(O_num) {
        $.ajax({
            url: "/StaffCheckOutChangeOrderServlet",
            type:'post',
            data:{O_num:O_num},
            dataType:'text',
            success: function(data){
                if(data == "结算成功") {
                    showResult("正常退房");
                    return;
                } else{
                    showResult("退房失败");
                }
            },
            error: function () {
                showResult("2出错，稍后重试！");
                window.history.back(-1);
                return;
            }
        });
    }

</script>

</body>

</html>
