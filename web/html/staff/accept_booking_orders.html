<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <title>已接收订单</title>

    <!-- Favicons -->
    <link href="../../img/favicon.png" rel="icon">
    <link href="../../img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Bootstrap core CSS -->
    <link href="../../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--external css-->
    <link href="../../lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="../../css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="../../lib/gritter/css/jquery.gritter.css" />
    <!-- Custom styles for this template -->
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/style-responsive.css" rel="stylesheet">
    <script src="../../lib/chart-master/Chart.js"></script>
    <script type="text/javascript" src="../../lib/layui/layui.all.js"></script>
    <link href="../../lib/layui/css/layui.css" rel="stylesheet" type="text/css"/>
    <script src="../../lib/jquery/jquery.js"></script>


    <!-- =======================================================
      Template Name: Dashio
      Template URL: https://templatemag.com/dashio-bootstrap-admin-template/
      Author: TemplateMag.com
      License: https://templatemag.com/license/
    ======================================================= -->
</head>

<body>
<section id="container">
    <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
        <div class="sidebar-toggle-box">
            <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
        </div>
        <!--logo start-->
        <a href="index.html" class="logo"><b>酒店<span>预订</span></b></a>
        <!--logo end-->
        <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
                <!-- settings start -->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                        <i class="fa fa-tasks"></i>
                        <div id = "red_num">
                            <span class="badge bg-theme"></span>
                        </div>
                    </a>
                    <ul class="dropdown-menu extended tasks-bar">
                        <div class="notify-arrow notify-arrow-green"></div>
                        <li>
                            <p class="green">你有待接收的预定</p>
                        </li>
                        <li class="external">
                            <a href="/html/staff/unaccept_booking_orders.html">查看详情</a>
                        </li>
                    </ul>
                </li>
                <!-- settings end -->
            </ul>
            <!--  notification end -->
        </div>
        <div class="top-menu">
            <ul class="nav pull-right top-menu">
                <li><a class="logout" href="login.html">登出</a></li>
            </ul>
        </div>
    </header>
    <!--header end-->
    <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu" id="nav-accordion">
                <p class="centered"><a href="profile.html"><img src="../../img/ui-sam.jpg" class="img-circle" width="80"></a></p>
                <h5 class="centered">Sam Soffes</h5>

                <li class="mt">
                    <a class="active" href="#">
                        <i class="glyphicon glyphicon-home"></i>
                        <span>首页</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;" class="active">
                        <i class="glyphicon glyphicon-pencil"></i>
                        <span>预定订单管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="unaccept_booking_orders.html">待接受的订单</a></li>
                        <li><a href="accept_booking_orders.html">已接收的订单</a></li>
                    </ul>
                </li>


                <li class="sub-menu">
                    <a class="" href="#">
                        <i class="glyphicon glyphicon-time"></i>
                        <span>办理入住</span>
                    </a>
                    <ul class="sub">
                        <li><a href="check_in_now.html">网上未预定入住</a></li>
                        <li><a href="check_in_net.html">网上预定入住</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a class="" href="close_account.html">
                        <i class="glyphicon glyphicon-time"></i>
                        <span>结算</span>
                    </a>
                </li>
            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <div class="row mt" style="height: 600px">
                <div class="col-md-12">
                    <div class="content-panel">
                        <table class="table table-striped table-advance table-hover">
                            <h4><i class="fa fa-align-left"></i>预订订单记录</h4>
                            <hr>
                            <thead>
                            <tr>
                                <th><i class="fa fa-bars"></i>订单号</th>
                                <th class="hidden-phone"><i class="fa fa-male"></i>预定人</th>
                                <th><i class="fa fa-home"></i>房间类型</th>
                                <th><i class=" fa fa-calendar"></i>入住日期</th>
                                <th><i class=" fa fa-phone"></i>手机号码</th>
                                <th><i class=" fa fa-edit"></i>订单状态</th>
                                <th></th>
                            </tr>
                            </thead>

                            <tbody id="table_content">
                            <!--<tr>-->
                                <!--<td id="order_number">001</td>-->
                                <!--<td class="hidden-phone" id="order_name">李涛</td>-->
                                <!--<td id="room_type">单人间</td>-->
                                <!--<td id="check_in_date">2018-12-31</td>-->
                                <!--<td id="phonenumber">12345678901</td>-->
                                <!--<td id="order_status"><span class="label label-info label-mini">Accept</span></td>-->
                                <!--<td>-->
                                    <!--<button class="btn btn-success btn-xs" name="detail"><i class="fa fa-pencil"></i></button>-->
                                    <!--<button class="btn btn-danger btn-xs" name="delete"><i class="fa fa-trash-o "></i></button>-->
                                <!--</td>-->
                            <!--</tr>-->
                            </tbody>

                        </table>

                    </div>
                    <!-- /content-panel -->
                </div>
                <!-- /col-md-12 -->
            </div>
            <!-- /row -->
        </section>
    </section>
    <!--main content end-->

    <!--分页-->
    <div id="order_page" style="text-align: center"> </div>
    <!--分页-->

    <!--footer start-->
    <footer class="site-footer">
        <div class="text-center">
            <p>
                &copy; Copyrights <strong>Dashio</strong>. All Rights Reserved
            </p>
            <div class="credits">
                <!--
                  You are NOT allowed to delete the credit link to TemplateMag with free version.
                  You can delete the credit link only if you bought the pro version.
                  Buy the pro version with working PHP/AJAX contact form: https://templatemag.com/dashio-bootstrap-admin-template/
                  Licensing information: https://templatemag.com/license/
                -->
                Created with Dashio template by <a href="https://templatemag.com/">TemplateMag</a>
            </div>
            <a href="index.html#" class="go-top">
                <i class="fa fa-angle-up"></i>
            </a>
        </div>
    </footer>
    <!--footer end-->
</section>

<script type="application/javascript">

    window.onload = function () {
        getUnreadNumStaff();
    };

    $(function () {
        if(!validateEmployee()) return;
        var pageNum = 0;//用来接收订单数量
        var obj;//用来接收查询的订单列表
        var pageNow = 1;// 当前的页

        initialData();

        //初始化数据
        function initialData(){
            getData(0);
        }

        /**
         *
         * @param page 当前的页号
         */
        function getData(page) {
            showProcess("table_content",7);
            $.ajax({
                url: "/SelectAllAcceptedOrderServlet",
                type:'post',
                data:{page:page},
                dataType:'text',
                success: function(data){
                    var str = data.split("!");
                    var total = parseInt(str[1]);
                    // 后台查询失败
                    if(str == "Error") {
                        $("#table_content").html("1加载数据失败，请稍后重试!");
                        return;
                    }
                    obj = JSON.parse(str[0]);
                    // 后台没有数据
                    if(obj.length == 0) {
                        $("#table_content").html("没有已预订的订单");
                        return
                    }
                    // 后台有>=1条数据
                    initialTable(page+1,obj,total);
                },
                error:  function () {
                    $("#table_content").html("2加载数据失败，请稍后重试!");
                }
            });
        }

        //获取订单状态
        function State(num) {
            switch (num){
                case 0:
                    return "未接受";
                case 1:
                    return "已接受";
                case 2:
                    return "已拒绝";
                case 3:
                    return "已入住";
                case 4:
                    return "已完成";
                case 5:
                    return "已取消";
            }
        }

        /**
         *
         * @param page 当前的页号
         * @param obj 获取当前页的数据
         * @param total 数据总量，用于设置分页
         */
        // 初始化表格
        function initialTable(page,obj,total) {
            pageNum = obj.length;
            setPage(page,total);
            var html = "";
            for(var i = 0; i < obj.length; i++){
                // 拼接内容
                html += "        <tr>\n" +
                    "            <td name=\"order_number\">";
                html += obj[i].O_num;
                html += "</td>\n" +
                    "            <td class=\"hidden-phone\" name=\"order_name\">";
                html += obj[i].C_name;
                html += "</td>\n" +
                    "            <td name=\"room_type\">";
                html += obj[i].typename;
                html += "</td>\n" +
                    "            <td name=\"check_in_date\">";
                html += obj[i].checkintime.split(" ")[0];
                html += obj[i].checkintime.split(" ")[1];
                html += obj[i].checkintime.split(" ")[2];
                html += "</td>\n" +
                    "            <td name=\"phonenumber\">";
                html += obj[i].C_phone;
                html += "</td>\n" +
                    "             <td name=\"order_status\"><span class=\"label label-info label-mini\">";
                html += State(obj[i].O_status);
                html += "</span></td>\n" +
                    "            <td>\n" +
                    "             <button class=\"btn btn-success btn-xs\" name=\"detail\"><i class=\"fa fa-pencil\"></i></button>\n" +
                    "            </td>\n" +
                    "            </tr>";
            }
            console.log(html);
            $("#table_content").html(html);

            // 详细信息和修改
            $("button[name='detail']").click(function () {
                //获取订单号
                var order_number = $($(this).parent().parent()).find("td[name='order_number']").html();
                console.log(order_number);
                sessionStorage.setItem("order_number1",order_number.trim());//页面之间传递数据
                window.open('./detail_booking_orders.html','_self');
            });
        }

        /**
         *
         * @param page 当前的页号
         * @param total 数据总量，用于设置分页
         */
        // 设置分页数量
        function setPage(page,total) {
            layui.use(['laypage','form','layer'], function(){
                var form = layui.form;
                var laypage = layui.laypage;
                var layer = layui.layer;
                //执行一个laypage实例
                laypage.render({
                    elem: 'order_page' //注意，这里的 test1 是 ID，不用加 # 号
                    ,count: total //数据总数，从服务端得到
                    ,curr:page
                    ,jump:function (obj,first) {
                        if(!first){
                            pageNow = obj.curr;
                            getData(obj.curr-1);
                        }
                    }
                });
                //监听指定开关
            });
        }
    });
</script>

<!-- js placed at the end of the document so the pages load faster -->
<script src="../../lib/jquery/jquery.min.js"></script>

<script src="../../lib/bootstrap/js/bootstrap.min.js"></script>
<script class="include" type="text/javascript" src="../../lib/jquery.dcjqaccordion.2.7.js"></script>
<script src="../../lib/jquery.scrollTo.min.js"></script>
<script src="../../lib/jquery.nicescroll.js" type="text/javascript"></script>
<script src="../../lib/jquery.sparkline.js"></script>
<!--common script for all pages-->
<script src="../../lib/common-scripts.js"></script>
<script type="text/javascript" src="../../lib/gritter/js/jquery.gritter.js"></script>
<script type="text/javascript" src="../../lib/gritter-conf.js"></script>
<!--script for this page-->
<script src="../../lib/sparkline-chart.js"></script>
<script src="../../lib/zabuto_calendar.js"></script>


<script src="../../lib/layui/layui.all.js"></script>
<script>
    ;!function(){
        var layer = layui.layer,form = layui.form;
    }();
</script>
<script src="../../lib/easyCookie.js"></script>
<script src="../../lib/my_common.js"></script>

</body>

</html>
