<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <title>现场办理入住</title>

    <!-- Favicons -->
    <link href="../../img/favicon.png" rel="icon">
    <link href="../../img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Bootstrap core CSS -->
    <link href="../../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--external css-->
    <link href="../../lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="../../css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="../../lib/gritter/css/jquery.gritter.css" />
    <!-- Custom styles for this template -->
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/style-responsive.css" rel="stylesheet">
    <script src="../../lib/chart-master/Chart.js"></script>
    <!--<script type="text/javascript" src="../../lib/layui/layui.all.js"></script>-->
    <link href="../../lib/layui/css/layui.css" rel="stylesheet" type="text/css"/>
    <script src="../../lib/jquery/jquery.js"></script>
    <script src="../../lib/layui/layui.js"></script>
    <script src="../../lib/my_common.js"></script>
    <!-- =======================================================
      Template Name: Dashio
      Template URL: https://templatemag.com/dashio-bootstrap-admin-template/
      Author: TemplateMag.com
      License: https://templatemag.com/license/
    ======================================================= -->
</head>

<body>
<section id="container">
    <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
        <div class="sidebar-toggle-box">
            <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
        </div>
        <!--logo start-->
        <a href="index.html" class="logo"><b>DASH<span>IO</span></b></a>
        <!--logo end-->
        <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
                <!-- settings start -->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                        <i class="fa fa-tasks"></i>
                        <span class="badge bg-theme">4</span>
                    </a>
                    <ul class="dropdown-menu extended tasks-bar">
                        <div class="notify-arrow notify-arrow-green"></div>
                        <li>
                            <p class="green">有4个请求尚待处理</p>
                        </li>
                        <li class="external">
                            <a href="#">查看详情</a>
                        </li>
                    </ul>
                </li>
                <!-- settings end -->
            </ul>
            <!--  notification end -->
        </div>
        <div class="top-menu">
            <ul class="nav pull-right top-menu">
                <li><a class="logout" href="login.html">登出</a></li>
            </ul>
        </div>
    </header>
    <!--header end-->
    <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu" id="nav-accordion">
                <p class="centered"><a href="profile.html"><img src="../../img/ui-sam.jpg" class="img-circle" width="80"></a></p>
                <h5 class="centered">Sam Soffes</h5>

                <li class="mt">
                    <a class="active" href="#">
                        <i class="glyphicon glyphicon-home"></i>
                        <span>首页</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="glyphicon glyphicon-pencil"></i>
                        <span>预定订单管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="unaccept_booking_orders.html">待接受的订单</a></li>
                        <li><a href="accept_booking_orders.html">已接收的订单</a></li>
                    </ul>
                </li>


                <li class="sub-menu">
                    <a class="active" href="#">
                        <i class="glyphicon glyphicon-time"></i>
                        <span>办理入住</span>
                    </a>
                    <ul class="sub">
                        <li><a href="check_in_now.html">网上未预定入住</a></li>
                        <li><a href="check_in_net.html">网上预定入住</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a class="" href="close_account.html">
                        <i class="glyphicon glyphicon-time"></i>
                        <span>结算</span>
                    </a>
                </li>
            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <hr/>
            <h3><i class="fa fa-user"></i>办理入住</h3>
            <hr style="height:10px;border:none;border-top:2px groove skyblue;" />
            <!--表单-->
            <form class="layui-form layui-form-pane" action="">
                <div class="layui-form-item">
                    <label class="layui-form-label">姓名</label>
                    <div class="layui-input-block">
                        <input name="C_name" class="layui-input" required="" type="text" placeholder="请输入姓名" autocomplete="off" lay-verify="required" id="name">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">证件号</label>
                    <div class="layui-input-block">
                        <input name="C_ID" class="layui-input" required="" type="text" placeholder="请输入证件号" autocomplete="off" lay-verify="required|identity" id="idcard">
                    </div>
                </div>

                <div class="layui-form-item" pane="">
                    <label class="layui-form-label">单选框</label>
                    <div class="layui-input-block">
                        <input name="sex" title="男" type="radio" value="男"><div class="layui-unselect layui-form-radio layui-form-radioed"><i class="layui-anim layui-icon layui-anim-scaleSpring"></i><div>男</div></div>
                        <input name="sex" title="女" type="radio" checked="" value="女"><div class="layui-unselect layui-form-radio"><i class="layui-anim layui-icon"></i><div>女</div></div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">手机号</label>
                    <div class="layui-input-block">
                        <input name="C_phone" class="layui-input" required="" type="text" placeholder="请输入手机号" autocomplete="off" lay-verify="required|phone" id="phonenumber">
                    </div>
                </div>

                <div>
                    <table>
                        <tr>
                            <td>
                                <label class="layui-form-label">房间类型</label>
                                <div class="layui-input-inline">
                                    <select name="R_roomtype" id="R_roomtype" lay-verify="required">
                                    </select>
                                </div>
                            </td>
                            <td>
                                <label class="layui-form-label">入住时间</label>
                                <div class="layui-input-inline">
                                    <input type="inDate" class="layui-input" id="inDate" name="inDate" autocomplete="off"
                                           placeholder="入住日期与离店日期">
                                </div>
                            </td>
                            <td>
                                <label class="layui-form-label">床型</label>
                                <div class="layui-input-inline">
                                    <select name="bedtype" id="bedtype" lay-verify="required">
                                    </select>
                                </div>
                            </td>
                            <td>
                                <label class="layui-form-label">无烟房</label>
                                <div class="layui-input-inline">
                                    <select name="smoke" lay-verify="required">
                                        <option value="0">是</option>
                                        <option value="1">否</option>
                                    </select>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div style="text-align: center">
                    <div class="layui-form-item">
                        <button class="layui-btn layui-btn-primary" lay-submit lay-filter="submit">提交</button>
                        <button class="layui-btn layui-btn-primary" id="clearAll" type="reset">清空</button>
                    </div>
                </div>
            </form>
            <!--表单-->

            <!--房间列表-->
            <div class="row mt" style="height: 300px">
                <div class="col-md-12">
                    <div class="content-panel">
                        <table class="table table-striped table-advance table-hover">
                            <h4><i class="fa fa-home"></i>可用房间</h4>
                            <hr>
                            <thead>
                            <tr>
                                <th><i class="fa fa-home"></i>房间类型</th>
                                <th class="hidden-phone"><i class="fa fa-bed"></i>床型</th>
                                <th><i class="fa fa-columns"></i>窗户</th>
                                <th><i class=" fa fa-picture-o"></i>可入住数</th>
                                <th><i class=" fa fa-rss"></i>无线网络</th>
                                <th><i class=" fa fa-wrench"></i>房间面积</th>
                                <th></th>
                            </tr>
                            </thead>

                            <tbody id="table_content">
                            </tbody>
                        </table>
                    </div>
                    <!-- /content-panel -->
                </div>
                <!-- /col-md-12 -->
            </div>
            <!--房间列表-->
            <!-- /row -->
        </section>
    </section>
    <!--main content end-->

    <!--分页-->
    <div id="order_page" style="text-align: center"> </div>
    <!--分页-->

    <!--footer start-->
    <footer class="site-footer">
        <div class="text-center">
            <p>
                &copy; Copyrights <strong>Dashio</strong>. All Rights Reserved
            </p>
            <div class="credits">
                <!--
                  You are NOT allowed to delete the credit link to TemplateMag with free version.
                  You can delete the credit link only if you bought the pro version.
                  Buy the pro version with working PHP/AJAX contact form: https://templatemag.com/dashio-bootstrap-admin-template/
                  Licensing information: https://templatemag.com/license/
                -->
                Created with Dashio template by <a href="https://templatemag.com/">TemplateMag</a>
            </div>
            <a href="index.html#" class="go-top">
                <i class="fa fa-angle-up"></i>
            </a>
        </div>
    </footer>
    <!--footer end-->
</section>

<!-- js placed at the end of the document so the pages load faster -->
<script src="../../lib/jquery/jquery.min.js"></script>

<script src="../../lib/bootstrap/js/bootstrap.min.js"></script>
<script class="include" type="text/javascript" src="../../lib/jquery.dcjqaccordion.2.7.js"></script>
<script src="../../lib/jquery.scrollTo.min.js"></script>
<script src="../../lib/jquery.nicescroll.js" type="text/javascript"></script>
<script src="../../lib/jquery.sparkline.js"></script>
<!--common script for all pages-->
<script src="../../lib/common-scripts.js"></script>
<script type="text/javascript" src="../../lib/gritter/js/jquery.gritter.js"></script>
<script type="text/javascript" src="../../lib/gritter-conf.js"></script>
<!--script for this page-->
<script src="../../lib/sparkline-chart.js"></script>
<script src="../../lib/zabuto_calendar.js"></script>
<!--<script src="../../lib/layui/layui.all.js"></script>-->
<script src="../../lib/layui/layui.js"></script>
<!--日期选择器-->
<script>
    layui.use('laydate', function () {
        var laydate = layui.laydate;
        //日期范围
        laydate.render({
            elem: '#inDate'
            , range: true
            , calendar: true
            , min: 0
            , max: 60
        });
    });
</script>

<script>
    $(function () {
        //员工编号待获取
        var E_num = "101001";

        var bookInfo = "";

        var index = 0;
        layui.use(['form', 'layedit', 'laydate'], function () {
            var form = layui.form;
            form.on('submit(submit)', function (data) {//提交表单


                bookInfo += "{\"typename\":\"" +data.field.R_roomtype+"\"";

                bookInfo += ",\"inDate\":\"" + data.field.inDate + "\"";

                bookInfo += ",\"bedtype\":\"" + data.field.bedtype + "\"";

                bookInfo += ",\"smoke\":\"" + data.field.smoke + "\"}";

                console.log(bookInfo);
                index = layer.load(0, {shade: false});
                $.ajax({
                    url: "/CheckInBookSearchServlet",
                    type:'post',
                    data:{roomInfo:bookInfo},
                    dataType:'text',
                    success: function(data){
                        if(data == 0) {
                            showResult("查询房间类型失败，请重试！");
                        } else {
                            //showResult("有可用的房间！");
                            obj = JSON.parse(data);
                            showRoomType(obj);
                        }
                    }});
                return false;
            });
        });
        initialData();
        // 初始化下拉框的值
        function initialData() {
            $.ajax({
                url: "/SelectMainRtypeBtypeServlet",
                type:'post',
                dataType:'text',
                success: function(data){
                    if(data == "Error") {
                        showResult("数据查询出错！");
                    } else {
                        var str = data.split("!");

                        var rtype = JSON.parse(str[0]);
                        var btype = JSON.parse(str[1]);
                        R_roomtype = $("#R_roomtype");
                        R_roomtype.empty();
                        for(var i = 0; i < rtype.length; i++){
                            R_roomtype.append('<option value="'+ rtype[i] +'">'+ rtype[i] + '</option>');
                        }

                        bedtype = $("#bedtype");
                        bedtype.empty();
                        for(var i = 0; i < btype.length; i++){
                            bedtype.append('<option value="'+ btype[i] +'">'+ btype[i] + '</option>');
                        }
                        layui.form.render();
                    }
                }});
        }

        //拼接显示内容
        function showRoomType(obj) {
            var html = "";
            for(var i = 0; i < obj.length; i++){
                // 拼接内容
                html += "        <tr>\n" +
                    "            <td name=\"room_type\">";
                html += obj[i].R_roomtype + "-" + obj[i].typename;
                html += "</td>\n" +
                    "            <td class=\"hidden-phone\" name=\"bed_type\">";
                html += obj[i].bedtype;
                html += "</td>\n" +
                    "            <td name=\"window\">";
                html += obj[i].windows;
                html += "</td>\n" +
                    "            <td name=\"people\">";
                html += obj[i].people;
                html += "</td>\n" +
                    "            <td name=\"wifi\">";
                html += obj[i].wifi;
                html += "</td>\n" +
                    "             <td name=\"facility\">";
                html += obj[i].area;
                html += "</td>\n" +
                    "            <td>\n" +
                    "             <button class=\"btn btn-success btn-xs\" name=\"detail\"><i class=\"fa fa-pencil\"></i></button>\n" +
                    "             <button class=\"btn btn-success btn-xs\" name=\"check\"'><i class=\"fa fa-check\"></i></button>\n" +
                    "            </td>\n" +
                    "            </tr>";
            }
            console.log(html);
            $("#table_content").html(html);
            layer.close(index);

            // 详细信息和修改
            $("button[name='detail']").click(function () {
                layer.open({
                    type: 1,
                    title: '客房详细信息界面',
                    shadeClose: true,
                    shade: false,
                    maxmin: true, //开启最大化最小化按钮
                    area: ['893px', '600px'],
                    content: $("#RoomTypeDetail")
                });

                var str =  $($(this).parent().parent()).find("td[name='room_type']").html();
                console.log(str);
                var R_roomtype = str.split("-")[0];
                console.log(R_roomtype);
                getData(R_roomtype);
            });

            //接受预订
            $("button[name='check']").click(function () {
                var CustomerInfo = "";

                CustomerInfo += "{\"C_ID\":\"" +$("input[name = 'C_ID']").val()+"\"";

                CustomerInfo += ",\"C_phone\":\"" + $("input[name = 'C_phone']").val()+ "\"";

                CustomerInfo += ",\"C_password\": \"000000\"";

                CustomerInfo += ",\"C_name\":\"" +$("input[name = 'C_name']").val() + "\"";

                CustomerInfo += ",\"C_sex\":\"" + $("input[name = 'sex']:checked").val()+ "\"}";

                console.log(CustomerInfo);
                //获取订单号
                var str = $($(this).parent().parent()).find("td[name='room_type']").html();
                console.log(str);
                var R_roomtype = str.split("-")[0];
                console.log(R_roomtype);
                sessionStorage.setItem("R_roomtype",R_roomtype.trim());//页面之间传递数据
                sessionStorage.setItem("CustomerInfo",CustomerInfo);
                sessionStorage.setItem("bookInfo",bookInfo);
                sessionStorage.setItem("E_num",E_num);
                window.open('./staff_choose_room_number.html','_self');
            });

        }

        // 获取数据
        function getData(R_roomtype) {
            $.ajax({
                url: "/SelectRoomTypeByTBServlet",
                type:'post',
                data:{R_roomtype:R_roomtype},
                dataType:'text',
                success: function(data){
                    var obj = JSON.parse(data);
                    console.log(obj);
                    // 后台查询失败
                    if(data == "Error") {
                        showResult("1出错，稍后重试！");
                        window.history.back(-1);
                        return;
                    } else{
                        initialData1(obj);
                    }
                },
                error: function () {
                    showResult("2出错，稍后重试！");
                    window.history.back(-1);
                    return;
                }
            });
        }

        // 数据初始化
        function initialData1(room) {
            layui.form.val("RoomInfo", { //表单初始化
                "typename": room.typename
                ,"bedtype": room.bedtype
                ,"people":room.people
                ,"area": room.area
                ,"roomnum": room.roomnum
                ,"wifi": room.wifi == 1? "有" : "无"
                ,"wirednet": room.wirednet == 1? "有" : "无"
                ,"windows": room.windows == 1? "有" : "无"
                ,"smoke": room.smoke == 1? "允许" : "禁止"
                ,"bathroom": room.bathroom == 1? "有" : "无"
                ,"facility": room.facility
                ,"price": room.price
                ,"other": room.other
            });
            layui.form.render();
        }

        // 显示插入的结果
        function showResult(content) {
            layer.open({
                content: content
                ,btn: ['确定']
                ,yes: function(index, layero){//删除
                    layer.closeAll();
                }
                ,cancel: function(){
                }
            });
        }
    });

</script>

</body>


    <div class="form-panel" style="display: none" id="RoomTypeDetail">
        <form class="layui-form layui-form-pane" lay-filter="RoomInfo">
            <div class="layui-form-item">
                <label class="layui-form-label">客房类型*</label>
                <div class="layui-input-block">
                    <input type="text" name="typename" lay-verify="required" placeholder="请输入客房类型名称"
                           autocomplete="off" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">床型*</label>
                <div class="layui-input-block">
                    <input type="text" name="bedtype" autocomplete="off" class="layui-input"
                           lay-verify="required" placeholder="请输入床型">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">价格*</label>
                <div class="layui-input-block">
                    <input type="text" name="price" autocomplete="off" class="layui-input"
                           placeholder="￥" lay-verify="required|number">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">人数*</label>
                <div class="layui-input-block">
                    <input type="text" name="people" placeholder="请输入人数" autocomplete="off"
                           class="layui-input" lay-verify="required|number">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">建筑面积*</label>
                <div class="layui-input-block">
                    <input type="text" name="area" placeholder="请输入面积" autocomplete="off"
                           class="layui-input" lay-verify="required|number">
                </div>
            </div>

            <div class="layui-form-item" pane="">
                <label class="layui-form-label">无限网络*</label>
                <div class="layui-input-block">
                    <input type="radio" name="wifi" value="有" title="有" checked="">
                    <input type="radio" name="wifi" value="无" title="无">
                </div>
            </div>

            <div class="layui-form-item" pane="">
                <label class="layui-form-label">有线网络*</label>
                <div class="layui-input-block">
                    <input type="radio" name="wirednet" value="有" title="有" checked="">
                    <input type="radio" name="wirednet" value="无" title="无">
                </div>
            </div>

            <div class="layui-form-item" pane="">
                <label class="layui-form-label">窗户*</label>
                <div class="layui-input-block">
                    <input type="radio" name="windows" value="有" title="有" checked="">
                    <input type="radio" name="windows" value="无" title="无">
                </div>
            </div>

            <div class="layui-form-item" pane="">
                <label class="layui-form-label">浴室*</label>
                <div class="layui-input-block">
                    <input type="radio" name="bathroom" value="有" title="有" checked="">
                    <input type="radio" name="bathroom" value="无" title="无">
                </div>
            </div>

            <div class="layui-form-item" pane="">
                <label class="layui-form-label">吸烟*</label>
                <div class="layui-input-block">
                    <input type="radio" name="smoke" value="允许" title="允许" checked="">
                    <input type="radio" name="smoke" value="禁止" title="禁止">
                </div>
            </div>

            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">便利设施*</label>
                <div class="layui-input-block">
                                    <textarea placeholder="请输入便利设施内容" class="layui-textarea" name="facility"
                                              lay-verify="required"></textarea>
                </div>
            </div>

            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">其他*</label>
                <div class="layui-input-block">
                                    <textarea name="other" placeholder="其他" class="layui-textarea"
                                              lay-verify="required"></textarea>
                </div>
            </div>
        </form>
    </div>

</html>
