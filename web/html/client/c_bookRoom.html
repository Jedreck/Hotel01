<!DOCTYPE html>
<html lang="en">

<head>
    <!--load-->
    <script src="../../lib/easyCookie.js"></script>
    <script>
        var cookies_phone = cookie.get("phone");
        var status_val = cookie.get("status");
        if (cookies_phone == null || status_val == null || status_val === "0") {
            top.location.href = "/html/common/index.html";
        }
    </script>
    <!--end load-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <title>客户预定房间</title>

    <!-- Favicons -->
    <link href="../../img/favicon.png" rel="icon">
    <link href="../../img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Bootstrap core CSS -->
    <link href="../../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--external css-->
    <link href="../../lib/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../../css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="../../lib/gritter/css/jquery.gritter.css"/>
    <!-- Custom styles for this template -->
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/style-responsive.css" rel="stylesheet">
    <script src="../../lib/chart-master/Chart.js"></script>
    <!--layUI-->
    <link rel="stylesheet" href="../../lib/layui/css/layui.css" media="all">
    <style type="text/css">
        .pic{
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
<section id="container">
    <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
        <div class="sidebar-toggle-box">
            <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
        </div>
        <!--logo start-->
        <a href="c_main.html" class="logo"><b>酒店<span>预订</span></b></a>
        <!--logo end-->
        <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
                <!-- settings start -->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                        <i class="fa fa-tasks"></i>
                        <span class="badge bg-theme">4</span>
                    </a>
                    <ul class="dropdown-menu extended tasks-bar">
                        <div class="notify-arrow notify-arrow-green"></div>
                        <li>
                            <p class="green">你有待接收的预定</p>
                        </li>
                        <li class="external">
                            <a href="#">查看详情</a>
                        </li>
                    </ul>
                </li>
                <!-- settings end -->
            </ul>
        </div>
        <div class="top-menu">
            <ul class="nav pull-right top-menu">
                <li><a class="logout" onclick="logout()">登出</a></li>
            </ul>
        </div>
    </header>
    <!--header end-->
    <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu" id="nav-accordion">
                <p class="centered"><a href="profile.html"><img src="../../img/ui-sam.jpg" class="img-circle"
                                                                width="80"></a></p>
                <h5 id="phone" class="centered"></h5>

                <li class="mt">
                    <a class="" href="c_main.html">
                        <i class="glyphicon glyphicon-home"></i>
                        <span>首页</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a class="active" href="#">
                        <i class="glyphicon glyphicon-edit"></i>
                        <span>预订房间</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="fa fa-cogs"></i>
                        <span>订单管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="/html/client/order_cancle.html">取消订单</a></li>
                        <li><a href="/html/client/order_management.html">历史记录</a></li>
                    </ul>
                </li>
            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <br>
            <form class="layui-form">
                <table border="0" style="margin:auto">
                    <tr>
                        <td>
                            <label class="labelFont">日期范围:</label>
                        </td>
                        <td colspan="3">
                            <input type="text" class="layui-input" id="inDate"
                                   style="margin-left: 5px"
                                   placeholder="入住日期与离店日期">
                        </td>
                        <td rowspan="5" style="width:150px">
                            <button class="layui-btn" style="margin-left: 20px" type="button" onclick="submitForm()">
                                立即提交
                            </button>
                        </td>
                    </tr>
                    <tr style="height: 25px;">
                        <td>
                            <label class="labelFont">人数:</label>
                        </td>
                        <td style="padding: 5px">
                            <input type="radio" name="people" value="1" title="1人" checked="">
                        </td>
                        <td style="padding: 5px">
                            <input type="radio" name="people" value="2" title="2人">
                        </td>
                        <td style="padding: 5px">
                            <input type="radio" name="people" value="3" title="3人">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="labelFont">网络:</label>
                        </td>
                        <td style="padding: 5px">
                            <input type="checkbox" name="wifi" value="1" title="WIFI" checked>
                        </td>
                        <td style="padding: 5px">
                            <input type="checkbox" name="wirednet" value="1" title="有线">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="labelFont">床型:</label>
                        </td>
                        <td style="padding: 5px">
                            <input type="checkbox" name="bed_M" value="1" title="标准" checked>
                        </td>
                        <td style="padding: 5px">
                            <input type="checkbox" name="bed_L" value="1" title="大床">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="labelFont">窗口:</label>
                        </td>
                        <td style="padding: 5px">
                            <input type="checkbox" name="window1" value="1" title="有窗">
                        </td>
                        <td style="padding: 5px">
                            <input type="checkbox" name="window0" value="1" title="无窗">
                        </td>
                    </tr>
                </table>
            </form>
            <!--检索结果-->
            <div style="min-width: 200px;min-height: 200px;">
                <div id="resultPanel" class="row mt">
                    <!--panel-->
                    <div class="col-md-4 col-sm-4 mb">
                        <div class="grey-panel pn donut-chart roomresult_panel">
                            <div class="grey-header">
                                <h3>样板间</h3>
                            </div>
                            <div style="height: 50%;width:200px;background-color: #9ecdca;margin-bottom: 10px;margin-left: auto;margin-right: auto">
                                <img src="../../img/404.png" alt="图片加载失败" name="pic" class="pic"/>
                            </div>
                            <table border="0" style="margin:auto;width: 90%;font-size: 16px">
                                <tr>
                                    <td width="20">大床</td>
                                    <td width="20">有线，WIFI</td>
                                    <td width="20">有窗</td>
                                </tr>
                            </table>
                            <!--<button class="layui-btn" style="margin-top: 5px">查看详情</button>-->
                            <button class="layui-btn" style="margin-top: 5px">查看详情/预订</button>
                            <!--</di/v>-->
                        </div>
                    </div>
                    <!--end panel-->
                </div>
            </div>
        </section>
    </section>
    <!--main content end-->
    <!--footer start-->
    <footer class="site-footer">
        <div class="text-center">
            <p>
                &copy; Copyrights <strong>Dashio</strong>. All Rights Reserved
            </p>
            <div class="credits">
                <!--
                  You are NOT allowed to delete the credit link to TemplateMag with free version.
                  You can delete the credit link only if you bought the pro version.
                  Buy the pro version with working PHP/AJAX contact form: https://templatemag.com/dashio-bootstrap-admin-template/
                  Licensing information: https://templatemag.com/license/
                -->
                Created with Dashio template by <a href="https://templatemag.com/">TemplateMag</a>
            </div>
            <a href="#" class="go-top">
                <i class="fa fa-angle-up"></i>
            </a>
        </div>
    </footer>
    <!--footer end-->
</section>
<!-- js placed at the end of the document so the pages load faster -->
<script src="../../lib/jquery/jquery.min.js"></script>

<script src="../../lib/bootstrap/js/bootstrap.min.js"></script>
<script class="include" type="text/javascript" src="../../lib/jquery.dcjqaccordion.2.7.js"></script>
<script src="../../lib/jquery.scrollTo.min.js"></script>
<script src="../../lib/jquery.nicescroll.js" type="text/javascript"></script>
<script src="../../lib/jquery.sparkline.js"></script>
<!--common script for all pages-->
<script src="../../lib/common-scripts.js"></script>
<script type="text/javascript" src="../../lib/gritter/js/jquery.gritter.js"></script>
<script type="text/javascript" src="../../lib/gritter-conf.js"></script>
<!--script for this page-->
<script src="../../lib/sparkline-chart.js"></script>
<script src="../../lib/zabuto_calendar.js"></script>


<script src="../../lib/layui/layui.all.js"></script>
<script src="../../lib/my_common.js"></script>

<script>
    var picUrl;
    console.log("check cookies--" + cookies_phone);
    $('#phone').text(cookies_phone);
    var bookInfo = cookie.get("bookInfo");
    console.log("bookInfo--" + bookInfo);
    var jsons = cookie.get("roomtypeJsons");
    if (jsons != null) {
        json2Div(jsons);
    } else if (bookInfo != null) {
        console.log("submit info");
        submitInfo(bookInfo);
    }

    //json2Div("123");


    function submitInfo(jsonStr) {
        $(document).ajaxStart(function () {
            layer.load(1);
        });
        $.ajax({
            url: "/bookSearchServlet",
            data: {jsondata: jsonStr},
            type: "post",
            before:function(){
                layer.load(2);
            },
            success: function (flag) {
                console.log(flag);
                if (flag === "0") {
                    alert("查询失败。。。");
                } else {
                    console.log("have info will fill !!");
                    json2Div(flag);
                }
            },
            error: function () {
                alert("网络错误。。。");
            },
            done:function () {
            }
        });
    }

    function json2Div(jsons) {
        console.log(jsons);
        cookie.setTemp("roomtypeJsons", jsons);
        var json = JSON.parse(jsons);
        var itemStr = "";
        if(json.length===0){
            itemStr+="搜索无结果。。。"
        }else {
            for (var i = 0; i < json.length; i++) {
                getPicUrl(json[i].R_roomtype);
                itemStr += "<div class=\"col-md-4 col-sm-4 mb\">\n" +
                    "                        <div class=\"grey-panel pn donut-chart roomresult_panel\">\n" +
                    "                            <div class=\"grey-header\">\n" +
                    "                                <h3>" + json[i].typename + "</h3>\n" +
                    "                            </div>\n" +
                    "                            <div style=\"height: 50%;width:200px;background-color: #9ecdca;margin-bottom: 10px;margin-left: auto;margin-right: auto\">\n" +
                    "<img alt=\"图片加载失败\" class='pic' name=\"pic\" src='"
                    + picUrl
                    + "'/>" +
                    "                            </div>\n" +
                    "                            <table border=\"0\" style=\"margin:auto;width: 90%;font-size: 16px\">\n" +
                    "                                <tr>\n" +
                    "                                    <td width=\"20\">";
                // if(json[i].bedtype==="大床房"){itemStr+=""}
                itemStr += json[i].bedtype;
                itemStr += "</td>\n" +
                    "                                    <td width=\"20\">";
                if (json[i].wifi === 1)
                    itemStr += " WIFI ";
                if (json[i].wirednet === 1)
                    itemStr += " 有线宽带 ";
                itemStr += "</td>\n" +
                    "                                    <td width=\"20\">";
                if (json[i].windows === 1)
                    itemStr += "有窗";
                itemStr += "</td>\n" +
                    "                                </tr>\n" +
                    "                            </table>\n" +
                    "                            <button class=\"layui-btn\" style=\"margin-top: 5px\" onclick='InfoDetail(";
                itemStr += i;
                itemStr += ")'>查看详情/预订</button>\n" +
                    "                            <!--</di/v>-->\n" +
                    "                        </div>\n" +
                    "                    </div>";
            }
        }
        $('#resultPanel').html(itemStr);
        console.log(itemStr);
        layer.closeAll('loading');
    }

    function setUrl(url) {
        console.log("======++++"  + url);
        picUrl = url;
    }

    function getPicUrl(R_roomtype) {
        picUrl = "../../img/404.png";
        //var picurl = "../../img/myImage/25/0c2a484d791230087f76fe5f7d412636.jpg";
        $.ajax({
            url: "/SelectPicByRT",
            data: {R_roomtype: R_roomtype},
            type: "post",
            async:false,
            success: function (data) {
                var obj = $.parseJSON(data);
                console.log("jsonsjon:" + obj[0]);
                if(obj.length > 0){
                    setUrl(obj[0]);
                }
            },
            error: function () {
                alert("网络错误。。。");
            }
        });
    }

</script>

<script>
    function InfoDetail(jsonNum) {
        var num = parseInt(jsonNum);
        console.log(num);
        cookie.setTemp("wantToSeeRoomtype", num);
        top.location.href = "/html/client/c_roomtypeDetail.html";
    }

    function submitForm() {
        console.log("submit");
        var bookInfo = "";
        var date = $('#inDate').val();
        if (date.length < 20) {
            layer.tips('请选择入住与结束日期', '#inDate', {
                tips: [2, '#cd2235'],
                time: 2000
            });
            return 0;
        }
        console.log("date:" + date);
        cookie.setTemp("orderDate",date);
        bookInfo += "{\"inDate\":\"" + date + "\"";

        var people = $('input:radio[name="people"]:checked').val();
        console.log("people:" + people);
        bookInfo += ",\"people\":\"" + people + "\"";

        var wifi = $('input:checkbox[name="wifi"]:checked').val();
        if (wifi == null)
            wifi = 0;
        console.log("wifi:" + wifi);
        bookInfo += ",\"wifi\":\"" + wifi + "\"";

        var wirednet = $('input:checkbox[name="wirednet"]:checked').val();
        if (wirednet == null)
            wirednet = 0;
        console.log("wirednet:" + wirednet);
        bookInfo += ",\"wirednet\":\"" + wirednet + "\"";

        var bedM = $('input:checkbox[name="bed_M"]:checked').val();
        if (bedM == null)
            bedM = 0;
        console.log("bed_M:" + bedM);
        var bedL = $('input:checkbox[name="bed_L"]:checked').val();
        if (bedL == null)
            bedL = 0;
        console.log("bed_L:" + bedL);
        if (bedL == 0 && bedM == 1) {
            bookInfo += ",\"bedtype\":\"标准床\"";
        } else if (bedL == 1 && bedM == 0) {
            bookInfo += ",\"bedtype\":\"大床\"";
        } else {
            bookInfo += ",\"bedtype\":\"\"";
        }

        var window1 = $('input:checkbox[name="window1"]:checked').val();
        if (window1 == null)
            window1 = 0;
        console.log("window1:" + window1);
        var window0 = $('input:checkbox[name="window0"]:checked').val();
        if (window0 == null)
            window0 = 0;
        console.log("window0:" + window0);
        if (window1 == 1 && window0 == 0) {
            bookInfo += ",\"window\":\"1\"";
        } else if (window1 == 0 && window0 == 1) {
            bookInfo += ",\"window\":\"0\"";
        } else {
            bookInfo += ",\"window\":\"\"";
        }
        bookInfo += "}";
        console.log("bookInfo:" + bookInfo);
        submitInfo(bookInfo);
    }
</script>

<script>
    layui.use(['carousel', 'form'], function () {
        var carousel = layui.carousel
            , form = layui.form;
    });
    layui.use('layer', function () {
        var layer = layui.layer;
    });
</script>
<!--日期选择器-->
<script>
    layui.use('laydate', function () {
        var laydate = layui.laydate;
        //日期范围
        laydate.render({
            elem: '#inDate'
            , range: true
            , calendar: true
            , min: 0
            , max: 60
        });
    });
    console.log("123123");
</script>


</body>

</html>
