<!DOCTYPE html>
<html lang="en">

<head>
    <!--load-->
    <script src="../../lib/easyCookie.js"></script>
    <script>
        var cookies_phone = cookie.get("phone");
        if (cookies_phone == null) {
            top.location.href = "/html/common/login.html";
        }
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <title>Profile</title>

    <!-- Favicons -->
    <link href="../../img/favicon.png" rel="icon">
    <link href="../../img/apple-touch-icon.png" rel="apple-touch-icon">
    <!-- Bootstrap core CSS -->
    <link href="../../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--external css-->
    <link href="../../lib/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <!-- Custom styles for this template -->
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/style-responsive.css" rel="stylesheet">
    <script src="../../lib/chart-master/Chart.js"></script>

    <!--layUI 图片轮播-->
    <link rel="stylesheet" href="../../lib/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../lib/layui/theme/default/layer.css" media="all">
    <!-- =======================================================
      Template Name: Dashio
      Template URL: https://templatemag.com/dashio-bootstrap-admin-template/
      Author: TemplateMag.com
      License: https://templatemag.com/license/
    ======================================================= -->
</head>

<body>
<section id="container">
    <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
        <div class="sidebar-toggle-box">
            <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
        </div>
        <!--logo start-->
        <a href="index.html" class="logo"><b>酒店<span>预订</span></b></a>
        <!--logo end-->
        <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
                <!-- settings start -->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                        <i class="fa fa-tasks"></i>
                        <span class="badge bg-theme">4</span>
                    </a>
                    <ul class="dropdown-menu extended tasks-bar">
                        <div class="notify-arrow notify-arrow-green"></div>
                        <li>
                            <p class="green">你有待接收的预定</p>
                        </li>
                        <li class="external">
                            <a href="#">查看详情</a>
                        </li>
                    </ul>
                </li>
                <!-- settings end -->
            </ul>
        </div>
        <div class="top-menu">
            <ul class="nav pull-right top-menu">
                <li><a class="logout" href="../common/index.html">登出</a></li>
            </ul>
        </div>
    </header>
    <!--header end-->
    <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu" id="nav-accordion">
                <p class="centered"><a href="c_profile.html"><img src="../../img/ui-sam.jpg" class="img-circle"
                                                                  width="80"></a></p>
                <h5 id="phoneHead" class="centered"></h5>

                <li class="mt">
                    <a class="active" href="#">
                        <i class="glyphicon glyphicon-home"></i>
                        <span>首页</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a class="" href="#">
                        <i class="glyphicon glyphicon-edit"></i>
                        <span>预订房间</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="fa fa-cogs"></i>
                        <span>订单管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="grids.html">取消订单</a></li>
                        <li><a href="calendar.html">历史记录</a></li>
                    </ul>
                </li>
            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper site-min-height">
            <div class="form-rigister">
                <h2 class="form-rigister-heading">会员信息</h2>
                <div class="login-wrap">
                    <div style="width: 300px;margin:0 auto;">
                        <form class="layui-form" action="">
                            <input type="text" class="form-control" placeholder="姓名" id="name" disabled>
                            <br>
                            <input type="text" class="form-control" placeholder="身份证号码" id="idcard" disabled>
                            <br>
                            <input type="text" class="form-control" placeholder="手机号码" id="phone" disabled>
                            <br>
                            <div class="layui-form-item">
                                <label class="layui-form-label">性别：</label>
                                <div class="layui-input-block">
                                    <input type="radio" id="sexM" name="sex" value="男" title="男" >
                                    <input type="radio" id="sexW" name="sex" value="女" title="女" >
                                </div>
                            </div>
                            <input type="password" class="form-control" placeholder="修改密码" id="pwd01" disabled>
                            <br>
                            <input type="password" class="form-control" placeholder="再次输入密码" id="pwd02" disabled>
                            <br>
                            <button class="btn btn-theme btn-block" onclick="modify()" type="button" id="modBtm">
                                修改
                            </button>
                            <button class="btn btn-theme05 btn-block" onclick="cansel()" type="reset" id="reset">
                                返回
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <!-- /container -->
        </section>
        <!-- /wrapper -->
    </section>
    <!-- /MAIN CONTENT -->
    <!--main content end-->
    <!--footer start-->
    <footer class="site-footer">
        <div class="text-center">
            <p>
                &copy; Copyrights <strong>Dashio</strong>. All Rights Reserved
            </p>
            <div class="credits">
                <!--
                  You are NOT allowed to delete the credit link to TemplateMag with free version.
                  You can delete the credit link only if you bought the pro version.
                  Buy the pro version with working PHP/AJAX contact form: https://templatemag.com/dashio-bootstrap-admin-template/
                  Licensing information: https://templatemag.com/license/
                -->
                Created with Dashio template by <a href="">TemplateMag</a>
            </div>
            <a href="#" class="go-top">
                <i class="fa fa-angle-up"></i>
            </a>
        </div>
    </footer>
    <!--footer end-->
</section>
<!-- js placed at the end of the document so the pages load faster -->
<script src="../../lib/jquery/jquery.min.js"></script>
<script src="../../lib/bootstrap/js/bootstrap.min.js"></script>
<script class="include" type="text/javascript" src="../../lib/jquery.dcjqaccordion.2.7.js"></script>
<script src="../../lib/jquery.scrollTo.min.js"></script>
<script src="../../lib/jquery.nicescroll.js" type="text/javascript"></script>
<!--common script for all pages-->
<script src="../../lib/common-scripts.js"></script>

<!--图片轮播script-->
<script src="../../lib/layui/layui.js" charset="utf-8"></script>
<script src="../../lib/easyCookie.js"></script>

<script>
    console.log("check cookies--" + cookies_phone);
    $('#phoneHead').text(cookies_phone);
    $('#phone').text("123123");
    var flag = "";
    $.ajax({
        url: "/GetProfileServlet",
        data: {jsondata: cookies_phone},
        type: "post",
        success: function (flag) {
            fillForm(flag)
        },
        error: function () {
            alert("网络错误。。。");
        }
    });

    function fillForm(flag) {
        console.log(flag);
        if (flag === "0") {
            alert("获取失败。。。");
            top.location.href = "/html/client/c_main.html";
        } else {
            enableAll();
            console.log("123123");
            var info = JSON.parse(flag);
            console.log(info.C_name.toString());
            $('#name').val(info.C_name);
            $('#idcard').val(info.C_ID);
            $('#phone').val(info.C_phone);
            if (info.C_sex.toString() === "男") {
                $("input[name='sex']").get(0).checked = true;
            } else {
                $("input[name='sex']").get(1).checked = true;
                // }
                layui.use('form', function () {
                    var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
                    form.render();
                });

                disableAll();
            }
        }
    }
</script>

<script>
    var STname = true;
    var STIDcard = true;
    var STphone = true;
    var STpwd1 = false;
    var STpwd2 = false;

    function btmCheck() {
        if (STname && STIDcard && STphone && STpwd1 && STpwd2) {
            $("#modBtm").attr("disabled", false);
            console.log("info can change!!")
        } else {
            $("#modBtm").attr("disabled", true);
            console.log("info can not change!!")
        }
    }

    layui.use('form', function () {
        var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
        form.render();
    });
    layui.use('layer', function () {
        var layer = layui.layer;
        $("#name").blur(function () {
            var regName = /^[\S]{2,12}$/;
            var con = $(this).val();
            var result = regName.test(con);
            if (result) {
                STname = true;
            } else {
                STname = false;
                layer.tips('请输入正确姓名，2~12个字符', '#name', {
                    tips: [2, '#cd2235'],
                    time: 2000
                });
            }
            btmCheck();
        });

        $("#idcard").blur(function () {
            var regIDcard = /^\d{6}(18|19|20)?\d{2}(0[1-9]|1[012])(0[1-9]|[12]\d|3[01])\d{3}(\d|[xX])$/;
            var con = $(this).val();
            var result = regIDcard.test(con);
            if (result) {
                STIDcard = true;
            } else {
                STIDcard = false;
                layer.tips('输入18位身份证号', '#idcard', {
                    tips: [2, '#cd2235'],
                    time: 2000
                });
            }
            btmCheck();
        });

        $("#phone").change(function () {
            var regPhone = /^1(3|4|5|7|8)\d{9}$/;
            var con = $(this).val();
            var result = regPhone.test(con);
            if (result) {
                STphone = true;
            } else {
                STphone = false;
                layer.tips('请正确输入11位手机号', '#phone', {
                    tips: [2, '#cd2235'],
                    time: 2000
                });
            }
            btmCheck();
        });

        $("#pwd01").change(function () {
            var regpwd01 = /^.{6,20}$/;
            var con = $(this).val();
            var result = regpwd01.test(con);
            if (result) {
                STpwd1 = true;
                $("#pwd02").attr("disabled", false);
            } else {
                STpwd1 = false;
                $("#pwd02").attr("disabled", true);
                layer.tips('输入6~20位密码', '#pwd01', {
                    tips: [2, '#cd2235'],
                    time: 2000
                });
            }
        });
        $("#pwd02").change(function () {
            var pwd1 = document.getElementById("pwd01").value;
            var pwd2 = document.getElementById("pwd02").value;
            if (pwd1 == pwd2) {
                STpwd2 = true;
            } else {
                STpwd2 = false;
                layer.tips('请输入相同密码', '#pwd02', {
                    tips: [2, '#cd2235'],
                    time: 2000
                });
            }
            btmCheck();
        })
    });

</script>

<script>
    <!--修改模式开与关-->
    var modifyMod = false;

    function modify() {
        if (!modifyMod) {
            console.log("turn modify to true");
            modifyMod = true;
            enableAll();
            layui.use('form', function () {
                var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
                form.render();
            });
            $("#reset").text("取消");
            $("#modBtm").text("确认修改");
            $("#modBtm").attr("disabled", true);
        } else {//修改模式下
            console.log("ready to change!!");
            rigist();
        }
    }

    function cansel() {
        if (!modifyMod) {
            top.location.href = "/html/client/c_main.html";
        } else {
            modifyMod = false;
            fillForm(flag);
            $("#reset").text("返回");
            $("#modBtm").text("修改");
            $("#modBtm").removeAttr("disabled");
        }
    }

    function enableAll() {
        $("#name").removeAttr("disabled");
        //$("#idcard").removeAttr("disabled");
        $("#phone").removeAttr("disabled");
        $("#pwd01").removeAttr("disabled");
        $("#sexM").removeAttr("disabled");
        $("#sexW").removeAttr("disabled");
    }

    function disableAll() {
        $("#name").attr("disabled", true);
        $("#idcard").attr("disabled", true);
        $("#phone").attr("disabled", true);
        $("#pwd01").attr("disabled", true);
        $("#pwd02").attr("disabled", true);
        $("#sexM").attr("disabled", true);
        $("#sexW").attr("disabled", true);
    }

</script>
<script>
    function rigist() {
        var result = true;
        var con;
        // 验证姓名
        var regName = /^[\S]{2,12}$/;
        var name = $("#name").val();
        result = regName.test(name);
        if (!result) {
            layer.tips('请输入正确姓名，2~12个字符', '#name', {
                tips: [2, '#cd2235'],
                time: 2000
            });
            return result;
        }
        // 验证身份证
        var regIDcard = /^\d{6}(18|19|20)?\d{2}(0[1-9]|1[012])(0[1-9]|[12]\d|3[01])\d{3}(\d|[xX])$/;
        var idcard = $("#idcard").val();
        result = regIDcard.test(idcard);
        if (!result) {
            layer.tips('输入18位身份证号', '#idcard', {
                tips: [2, '#cd2235'],
                time: 2000
            });
            return result;
        }
        // 验证手机号
        var regPhone = /^1(3|4|5|7|8)\d{9}$/;
        phone = $("#phone").val();
        result = regPhone.test(phone);
        if (!result) {
            layer.tips('请正确输入11位手机号', '#phone', {
                tips: [2, '#cd2235'],
                time: 2000
            });
            return result;
        }
        //验证密码
        var regpwd01 = /^.{6,20}$/;
        var pwd01 = $("#pwd01").val();
        result = regpwd01.test(pwd01);
        if (!result) {
            layer.tips('输入6~20位密码', '#pwd01', {
                tips: [2, '#cd2235'],
                time: 2000
            });
            return result;
        }

        var pwd02 = $("#pwd02").val();
        if (pwd01 !== pwd02) {
            layer.tips('请输入相同密码', '#pwd02', {
                tips: [2, '#cd2235'],
                time: 2000
            });
            return false;
        }

        var sex = $('input:radio[name="sex"]:checked').val();

        // 向后台传递的注册信息
        var formjson = "{\"C_ID\":\"" + idcard + "\",\"C_phone\":\"" + phone + "\",\"C_password\":\"" + pwd01 + "\",\"C_name\":\"" + name + "\",\"C_sex\":\"" + sex + "\"}";
        console.log("json--" + formjson);

        $.ajax({
            url: "/ModifyCustomerServlet",
            data: {jsondata: formjson},
            type: "post",
            success: function (flag) {
                console.log(flag);
                if (flag==="0") {
                    alert("修改失败。。。");
                }else {
                    alert("修改成功。。。");
                    cookie.setTemp("phone",phone);
                    top.location.href = "/html/client/c_main.html";
                }
            },
            error: function () {
                alert("网络错误。。。");
            }
        })
    }

</script>
</body>

</html>
