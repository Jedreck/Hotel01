<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <title>客房类型详细信息</title>

    <!-- Favicons -->
    <link href="../../img/favicon.png" rel="icon">
    <link href="../../img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Bootstrap core CSS -->
    <link href="../../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--external css-->
    <link href="../../lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="../../css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="../../lib/gritter/css/jquery.gritter.css" />
    <!-- Custom styles for this template -->
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/style-responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="../../lib/layui/css/layui.css"  media="all">
    <script src="../../lib/chart-master/Chart.js"></script>

    <!-- =======================================================
      Template Name: Dashio
      Template URL: https://templatemag.com/dashio-bootstrap-admin-template/
      Author: TemplateMag.com
      License: https://templatemag.com/license/
    ======================================================= -->
</head>

<body>
<section id="container">
    <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
        <div class="sidebar-toggle-box">
            <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
        </div>
        <!--logo start-->
        <a href="../common/index.html" class="logo"><b>酒店<span>预订</span></b></a>
        <!--logo end-->
        <div class="top-menu">
            <ul class="nav pull-right top-menu">
                <li><a class="logout" onclick="logout()">登出</a></li>
            </ul>
        </div>
    </header>
    <!--header end-->
    <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu" id="nav-accordion">
                <p class="centered"><a href="profile.html"><img src="../../img/ui-sam.jpg" class="img-circle"
                                                                width="80"></a></p>
                <h5 class="centered">Sam Soffes</h5>

                <li class="mt">
                    <a href="#">
                        <i class="fa fa-home"></i>
                        <span>首页</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="fa fa-users"></i>
                        <span>客户管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="m_clist.html">客户列表</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="fa fa-group"></i>
                        <span>员工管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="m_stalist.html">员工列表</a></li>
                        <li><a href="m_addsta.html">添加员工</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a class="active" href="javascript:;">
                        <i class="fa fa-edit"></i>
                        <span>客房管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="m_roomtypelist.html">客房类型列表</a></li>
                        <li><a href="m_addRoomType.html">添加客房类型</a></li>
                        <li><a href="m_addRoomlist.html">房间列表</a></li>
                        <li><a href="m_addRoom.html">添加房间</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="fa fa-edit"></i>
                        <span>数据详情</span>
                    </a>
                    <ul class="sub">
                        <li><a href="m_cdataAnalysis.html">顾客的数据详情</a></li>
                        <li><a href="m_staDataAnalysis.html">员工的数据详情</a></li>
                        <li><a href="m_hotelDataAnalysis.html">运营的数据详情</a></li>
                    </ul>
                </li>

            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper" style="background-color: #f6fff1">
            <h3 style="margin-top: 10px"><i class="fa fa-info-circle"></i> 客房类型详细信息</h3>
            <div class="row mt">
                <!--  DATE PICKERS -->
                <div class="col-lg-12">
                    <div class="form-panel" style="display: none">
                        <form class="layui-form layui-form-pane" lay-filter="RoomInfo">
                            <div class="layui-form-item">
                                <label class="layui-form-label">客房类型*</label>
                                <div class="layui-input-block">
                                    <input type="text" name="typename" lay-verify="required" placeholder="请输入客房类型名称"
                                           autocomplete="off" class="layui-input">
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">床型*</label>
                                <div class="layui-input-block">
                                    <input type="text" name="bedtype" autocomplete="off" class="layui-input"
                                           lay-verify="required" placeholder="请输入床型">
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">价格*</label>
                                <div class="layui-input-block">
                                    <input type="text" name="price" autocomplete="off" class="layui-input"
                                           placeholder="￥" lay-verify="required|number">
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">人数*</label>
                                <div class="layui-input-block">
                                    <input type="text" name="people" placeholder="请输入人数" autocomplete="off"
                                           class="layui-input" lay-verify="required|number">
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">建筑面积*</label>
                                <div class="layui-input-block">
                                    <input type="text" name="area" placeholder="请输入面积" autocomplete="off"
                                           class="layui-input" lay-verify="required|number">
                                </div>
                            </div>

                            <!--<div class="layui-form-item">-->
                            <!--<label class="layui-form-label">楼层*</label>-->
                            <!--<div class="layui-input-block">-->
                            <!--<input type="text" name="R_story" placeholder="请填写楼层" autocomplete="off"-->
                            <!--class="layui-input" lay-verify="required|number">-->
                            <!--</div>-->
                            <!--</div>-->


                            <div class="layui-form-item" pane="">
                                <label class="layui-form-label">无限网络*</label>
                                <div class="layui-input-block">
                                    <input type="radio" name="wifi" value="有" title="有" checked="">
                                    <input type="radio" name="wifi" value="无" title="无">
                                </div>
                            </div>

                            <div class="layui-form-item" pane="">
                                <label class="layui-form-label">有线网络*</label>
                                <div class="layui-input-block">
                                    <input type="radio" name="wirednet" value="有" title="有" checked="">
                                    <input type="radio" name="wirednet" value="无" title="无">
                                </div>
                            </div>

                            <div class="layui-form-item" pane="">
                                <label class="layui-form-label">窗户*</label>
                                <div class="layui-input-block">
                                    <input type="radio" name="windows" value="有" title="有" checked="">
                                    <input type="radio" name="windows" value="无" title="无">
                                </div>
                            </div>

                            <div class="layui-form-item" pane="">
                                <label class="layui-form-label">浴室*</label>
                                <div class="layui-input-block">
                                    <input type="radio" name="bathroom" value="有" title="有" checked="">
                                    <input type="radio" name="bathroom" value="无" title="无">
                                </div>
                            </div>

                            <div class="layui-form-item" pane="">
                                <label class="layui-form-label">吸烟*</label>
                                <div class="layui-input-block">
                                    <input type="radio" name="smoke" value="允许" title="允许" checked="">
                                    <input type="radio" name="smoke" value="禁止" title="禁止">
                                </div>
                            </div>

                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">便利设施*</label>
                                <div class="layui-input-block">
                                    <textarea placeholder="请输入便利设施内容" class="layui-textarea" name="facility"
                                              lay-verify="required"></textarea>
                                </div>
                            </div>

                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">其他*</label>
                                <div class="layui-input-block">
                                    <textarea name="other" placeholder="其他" class="layui-textarea"
                                              lay-verify="required"></textarea>
                                </div>
                            </div>

                            <div class="layui-form" style="margin-bottom: 10px">
                                <div class="layui-input-inline" style="width: 100%;left: 0px">
                                    <button id="uploadBT" class="btn btn-theme btn-lg btn-block" type="button">上传图片</button>
                                </div>
                            </div>

                            <div class="layui-form" style="margin-bottom: 10px">
                                <div class="layui-input-inline" style="width: 100%;left: 0px">
                                    <button id="deletePic" class="btn btn-theme btn-lg btn-block" type="button">删除图片</button>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <button class="layui-btn" lay-submit="" lay-filter="submit">提交</button>
                                <button class="layui-btn layui-btn-danger" id="clearAll" type="reset" >清空</button>
                                <button class="layui-btn layui-btn-danger" id="delete" type="button" >删除</button>
                            </div>
                        </form>
                    </div>
                    <!-- /form-panel -->
                </div>
                <!-- /col-lg-12 -->
            </div>
        </section>
        <!-- /wrapper -->
    </section>
    <!--main content end-->
    <!--footer start-->
    <footer class="site-footer">
        <div class="text-center">
            <p>
                &copy; Copyrights <strong>Dashio</strong>. All Rights Reserved
            </p>
            <div class="credits">
                <!--
                  You are NOT allowed to delete the credit link to TemplateMag with free version.
                  You can delete the credit link only if you bought the pro version.
                  Buy the pro version with working PHP/AJAX contact form: https://templatemag.com/dashio-bootstrap-admin-template/
                  Licensing information: https://templatemag.com/license/
                -->
                Created with Dashio template by <a href="https://templatemag.com/">TemplateMag</a>
            </div>
            <a href="index.html#" class="go-top">
                <i class="fa fa-angle-up"></i>
            </a>
        </div>
    </footer>
    <!--footer end-->

</section>
<!-- js placed at the end of the document so the pages load faster -->
<script src="../../lib/jquery/jquery.min.js"></script>

<script src="../../lib/bootstrap/js/bootstrap.min.js"></script>
<script class="include" type="text/javascript" src="../../lib/jquery.dcjqaccordion.2.7.js"></script>
<script src="../../lib/jquery.scrollTo.min.js"></script>
<script src="../../lib/jquery.nicescroll.js" type="text/javascript"></script>
<script src="../../lib/jquery.sparkline.js"></script>
<!--common script for all pages-->
<script src="../../lib/common-scripts.js"></script>
<script type="text/javascript" src="../../lib/gritter/js/jquery.gritter.js"></script>
<script type="text/javascript" src="../../lib/gritter-conf.js"></script>
<!--script for this page-->
<script src="../../lib/sparkline-chart.js"></script>
<script src="../../lib/zabuto_calendar.js"></script>


<script src="../../lib/layui/layui.js"></script>
<script src="../../lib/easyCookie.js"></script>
<script src="../../lib/my_common.js"></script>
<script>
    $(function () {
        if(!validateEmployee()) return;
        layui.use(['form', 'layedit', 'laydate'], function(){
            var form = layui.form;
            form.on('submit(submit)',function (data) {//提交表单
                data.field.smoke = data.field.smoke == "禁止" ? 0 : 1;
                data.field.bathroom = data.field.bathroom == "无" ? 0 : 1;
                data.field.wifi = data.field.wifi == "无" ? 0 : 1;
                data.field.wirednet = data.field.wirednet == "无" ? 0 : 1;
                data.field.windows = data.field.windows == "无" ? 0 : 1;
                data.field.R_roomtype = sessionStorage.getItem("R_roomtype");
                updateRTData(data.field);
                return false;
            });
        });

        // 提交数据，更新房间类型
        function updateRTData(roomType) {
            $.ajax({
                url: "/UpdateRoomTypeServlet",
                type:'post',
                data:{roomType:JSON.stringify(roomType)},
                dataType:'text',
                success: function(data){
                    // 后台查询失败
                    if(data == 0) {
                        showResult("修改出错，稍后重试！");
                        return;
                    } else {
                        showResult("修改数据成功!");
                    }
                },
                error: function () {
                    showResult("出错，稍后重试！");
                }
            });
        }
        initialForm();
        // 初始化表单
        function initialForm(){
            var R_roomtype = sessionStorage.getItem("R_roomtype");
            getData(R_roomtype);
        }
        // 数据初始化
        function initialData(room) {
            layui.form.val("RoomInfo", { //表单初始化
                "typename": room.typename
                ,"bedtype": room.bedtype
                ,"people":room.people
                ,"area": room.area
                ,"roomnum": room.roomnum
                ,"wifi": room.wifi == 1? "有" : "无"
                ,"wirednet": room.wirednet == 1? "有" : "无"
                ,"windows": room.windows == 1? "有" : "无"
                ,"smoke": room.smoke == 1? "允许" : "禁止"
                ,"bathroom": room.bathroom == 1? "有" : "无"
                ,"facility": room.facility
                ,"price": room.price
                ,"other": room.other
            });
            // 下拉出表单
            $("div[class='form-panel']").slideToggle();
            layui.form.render();
            removeProcess2();
        }

        // 删除房间类型
        $("button[id='delete']").click(function () {
            layer.open({
                content: '确定删除吗？'
                ,btn: ['删除', '取消']
                ,yes: function(index, layero){ //删除
                    layer.closeAll(); //关闭所有窗口
                    deleteData(sessionStorage.getItem("R_roomtype"));
                }
                ,btn2: function(index, layero){
                }
                ,cancel: function(){
                }
            });
        });

        // 获取数据
        function getData(R_roomtype) {
            $(document).ajaxStart(function () {
                showProcess2($("div[class='col-lg-12']"));
            });
            $.ajax({
                url: "/SelectRoomTypeByTBServlet",
                type:'post',
                data:{R_roomtype:R_roomtype},
                dataType:'text',
                success: function(data){
                    var obj = JSON.parse(data);
                    // 后台查询失败
                    if(data == "Error") {
                        showResult("1出错，稍后重试！");
                        window.history.back(-1);
                        return;
                    } else{
                        initialData(obj);
                    }
                },
                error: function () {
                    showResult("2出错，稍后重试！");
                    window.history.back(-1);
                    return;
                }
            });
        }

        // 根据房间类型编号删除相应的类型
        function deleteData(R_roomtype) {
            $.ajax({
                url: "/DeleteRoomTypeServlet",
                type:'post',
                data:{R_roomtype:R_roomtype},
                dataType:'text',
                success: function(data){
                    // 后台删除失败
                    if(data != 1) {
                        showResult("1删除失败！");
                    } else {
                        showResult("删除成功！");
                    }
                },
                error: function () {
                    showResult("2删除失败！");
                }
            });
        }

        // 显示插入的结果
        function showResult(content) {
            layer.open({
                content: content
                ,btn: ['确定']
                ,yes: function(index, layero){//删除
                    layer.closeAll();
                }
                ,cancel: function(){
                }
            });
        }

        /**
         * 显示上传弹出框
         */
        $("#uploadBT").click(function () {
            var R_roomtype = sessionStorage.getItem("R_roomtype");
            layui.use(['upload'], function(){

                // 文件上传
                var upload = layui.upload;
                //多文件列表示例
                var demoListView = $('#demoList')
                    ,uploadListIns = upload.render({
                    elem: '#testList'
                    ,method:'post'
                    ,url: '/UploadRTPicServlet' + "?R_roomtype=" + R_roomtype
                    ,multiple: true
                    ,auto: false
                    ,accept:'images'
                    ,acceptMime:'image/*'
                    ,number:5
                    ,bindAction: '#testListAction'
                    ,before:function (obj) {
                        layer.load();
                    }
                    ,choose: function(obj){
                        console.log("选择文件" + obj.length);
                        var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
                        //读取本地文件
                        obj.preview(function(index, file, result){
                            //obj.resetFile(index, file, '123.jpg'); //重命名文件名
                            var tr = $(['<tr id="upload-'+ index +'">'
                                ,'<td>'+ file.name +'</td>'
                                ,'<td>'+ (file.size/1014).toFixed(1) +'kb</td>'
                                ,'<td>等待上传</td>'
                                ,'<td>'
                                ,'<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
                                ,'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                                ,'</td>'
                                ,'</tr>'].join(''));

                            //单个重传
                            tr.find('.demo-reload').on('click', function(){
                                obj.upload(index, file);
                            });

                            //删除
                            tr.find('.demo-delete').on('click', function(){
                                delete files[index]; //删除对应的文件
                                tr.remove();
                                uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                            });

                            demoListView.append(tr);
                        });
                    }
                    ,done: function(res, index, upload){
                        layer.closeAll("loading");
                        console.log("上传完成" + index);
                        if(res.code == 0){ //上传成功
                            var tr = demoListView.find('tr#upload-'+ index)
                                ,tds = tr.children();
                            tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
                            tds.eq(3).html(''); //清空操作
                            return delete this.files[index]; //删除文件队列已经上传成功的文件
                        }
                        this.error(index, upload);
                    }
                    ,error: function(index, upload){
                        console.log("上传文件失败！");
                        var tr = demoListView.find('tr#upload-'+ index)
                            ,tds = tr.children();
                        tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
                        tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传
                    },allDone:function () {
                        removeProcess2();
                    }
                });

            });
            layer.open({
                type: 1,
                fixed: true, //固定
                skin: 'layui-layer-rim', //加上边框
                area: ['700px', '450px'],
                content: $("#uploadDIV")
            });
        });

        $("#deletePic").click(function () {
            $(document).ajaxStart(function () {
                removeProcess2();
                layer.load(1);
            });
            var R_roomtype = sessionStorage.getItem("R_roomtype");
            $.ajax({
                url: "/DeletePicServlet",
                type:'post',
                data:{R_roomtype:R_roomtype},
                dataType:'text',
                success: function(data){
                    // 后台删除失败
                    if(data == 0) {
                        showResult("该类型没有图片！");
                    } else {
                        showResult("删除成功！");
                    }
                },
                error: function () {
                    showResult("2删除失败！");
                }
            });
            layer.closeAll('loading');
        });

    });

</script>


</body>
<!--文件上传的部分-->
<div class="layui-upload" id="uploadDIV" style="display: none;padding:10px">
    <button type="button" class="layui-btn layui-btn-normal" id="testList">选择多个图片</button>
    <div class="layui-upload-list">
        <table class="layui-table">
            <thead>
            <tr><th>文件名</th>
                <th>大小</th>
                <th>状态</th>
                <th>操作</th>
            </tr></thead>
            <tbody id="demoList"></tbody>
        </table>
    </div>
    <button type="button" class="layui-btn" id="testListAction">开始上传</button>
</div>
</html>
