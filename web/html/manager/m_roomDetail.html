<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <title>添加房间</title>

    <!-- Favicons -->
    <link href="../../img/favicon.png" rel="icon">
    <link href="../../img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Bootstrap core CSS -->
    <link href="../../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--external css-->
    <link href="../../lib/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../../css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="../../lib/gritter/css/jquery.gritter.css"/>
    <!-- Custom styles for this template -->
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/style-responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="../../lib/layui/css/layui.css" media="all">
    <script src="../../lib/chart-master/Chart.js"></script>

    <!-- =======================================================
      Template Name: Dashio
      Template URL: https://templatemag.com/dashio-bootstrap-admin-template/
      Author: TemplateMag.com
      License: https://templatemag.com/license/
    ======================================================= -->
</head>

<body>
<section id="container">
    <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
        <div class="sidebar-toggle-box">
            <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
        </div>
        <!--logo start-->
        <a href="../common/index.html" class="logo"><b>酒店<span>预订</span></b></a>
        <!--logo end-->
        <div class="top-menu">
            <ul class="nav pull-right top-menu">
                <li><a class="logout" href="../common/index.html">登出</a></li>
            </ul>
        </div>
    </header>
    <!--header end-->
    <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu" id="nav-accordion">
                <p class="centered"><a href="profile.html"><img src="../../img/ui-sam.jpg" class="img-circle"
                                                                width="80"></a></p>
                <h5 class="centered">Sam Soffes</h5>

                <li class="mt">
                    <a href="/AddRoomTypeServlet">
                        <i class="fa fa-home"></i>
                        <span>首页</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="fa fa-users"></i>
                        <span>客户管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="m_clist.html">客户列表</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="fa fa-group"></i>
                        <span>员工管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="m_stalist.html">员工列表</a></li>
                        <li><a href="m_addsta.html">添加员工</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a class="active" href="javascript:;">
                        <i class="fa fa-edit"></i>
                        <span>客房管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="m_roomtypelist.html">客房类型列表</a></li>
                        <li><a href="m_addRoomType.html">添加客房类型</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="fa fa-edit"></i>
                        <span>数据详情</span>
                    </a>
                    <ul class="sub">
                        <li><a href="m_cdataAnalysis.html">顾客的数据详情</a></li>
                        <li><a href="m_addRoomType.html">员工的数据详情</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a class="" href="#">
                        <i class="glyphicon glyphicon-time"></i>
                        <span>预订客房管理</span>
                    </a>
                </li>
            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <h3 style="margin-top: 10px"><i class="fa fa-angle-right"></i> 添加房间</h3>
            <div class="row mt">
                <!--  DATE PICKERS -->
                <div class="col-lg-12">
                    <div class="form-panel">
                        <form class="layui-form layui-form-pane" lay-filter="RoomInfo">

                            <div class="layui-form-item">
                                <label class="layui-form-label">房间编号*:</label>
                                <div class="layui-input-block">
                                    <input type="text" name="R_num" autocomplete="off"
                                           placeholder="请填写房间号" class="layui-input" lay-verify="required">
                                </div>
                            </div>

                            <div class="layui-form form-group">
                                <label class="layui-form-label">所属类型*：</label>
                                <div class="layui-input-block">
                                    <select id="typename" lay-filter="R_roomtype" name="R_roomtype">
                                    </select>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">楼层:*</label>
                                <div class="layui-input-block">
                                    <input type="text" name="R_floor" autocomplete="off" class="layui-input"
                                           lay-verify="required" placeholder="请输入楼层" >
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <button class="layui-btn" lay-submit="" lay-filter="submit">提交</button>
                                <button class="layui-btn layui-btn-danger" id="clearAll" type="reset">清空</button>
                                <button class="layui-btn layui-btn-danger" id="delete" type="button">删除</button>
                            </div>
                        </form>
                    </div>
                    <!-- /form-panel -->
                </div>
                <!-- /col-lg-12 -->
            </div>
        </section>
        <!-- /wrapper -->
    </section>
    <!--main content end-->
    <!--footer start-->
    <footer class="site-footer">
        <div class="text-center">
            <p>
                &copy; Copyrights <strong>Dashio</strong>. All Rights Reserved
            </p>
            <div class="credits">
                <!--
                  You are NOT allowed to delete the credit link to TemplateMag with free version.
                  You can delete the credit link only if you bought the pro version.
                  Buy the pro version with working PHP/AJAX contact form: https://templatemag.com/dashio-bootstrap-admin-template/
                  Licensing information: https://templatemag.com/license/
                -->
                Created with Dashio template by <a href="https://templatemag.com/">TemplateMag</a>
            </div>
            <a href="index.html#" class="go-top">
                <i class="fa fa-angle-up"></i>
            </a>
        </div>
    </footer>
    <!--footer end-->

</section>
<!-- js placed at the end of the document so the pages load faster -->
<script src="../../lib/jquery/jquery.min.js"></script>

<script src="../../lib/bootstrap/js/bootstrap.min.js"></script>
<script class="include" type="text/javascript" src="../../lib/jquery.dcjqaccordion.2.7.js"></script>
<script src="../../lib/jquery.scrollTo.min.js"></script>
<script src="../../lib/jquery.nicescroll.js" type="text/javascript"></script>
<script src="../../lib/jquery.sparkline.js"></script>
<!--common script for all pages-->
<script src="../../lib/common-scripts.js"></script>
<script type="text/javascript" src="../../lib/gritter/js/jquery.gritter.js"></script>
<script type="text/javascript" src="../../lib/gritter-conf.js"></script>
<!--script for this page-->
<script src="../../lib/sparkline-chart.js"></script>
<script src="../../lib/zabuto_calendar.js"></script>


<script src="../../lib/layui/layui.js"></script>
<script>
    $(function () {
        layui.use(['form', 'layedit', 'laydate'], function () {
            var form = layui.form;
            form.on('submit(submit)', function (data) {//提交表单
                data.field.R_roomtype = parseInt(data.field.R_roomtype.split("-")[0]);
                data.field.R_floor = parseInt(data.field.R_floor);
                var json = JSON.stringify(data.field);
                $.ajax({
                    url: "/AddRoomServlet",
                    type:'post',
                    data:{roomInfo:json},
                    dataType:'text',
                    success: function(data){
                        if(data == 0) {
                            showResult("修改房间失败，请重试！");
                        } else {
                            showResult("修改房间成功！");
                        }
                    }});
                return false;
            });
        });
        initialData();
        // 初始化数据
        function initialData() {
            var R_num = sessionStorage.getItem("R_num");
            $.ajax({
                url: "/SelectRoomByRNServlet",
                type:'post',
                data:{R_num:R_num},
                dataType:'text',
                success: function(data){
                    if(data == "Error") {
                        showResult("数据查询出错！");
                    } else {
                        var str = data.split("!");
                        var obj = JSON.parse(str[0]);
                        // 下拉框初始化
                        typename = $("#typename");
                        typename.empty();
                        for(var i = 0; i < obj.length; i++){
                            var value = obj[i].R_roomtype + '-' +obj[i].typename;
                            typename.append('<option value="'+ value +'">'+ value + '</option>');
                        }
                        layui.form.render();
                        initialForm(JSON.parse(str[1]));

                    }
                }});
        }

        // 显示结果
        function showResult(content) {
            layer.open({
                content: content
                ,btn: ['确定']
                ,yes: function(index, layero){//删除
                    layer.closeAll();
                }
                ,cancel: function(){
                }
            });
        }

        // 表单初始化
        function initialForm(room) {
            layui.form.val("RoomInfo", { //表单初始化
                "R_num": room.R_num
                ,"R_floor":room.R_floor
            });
            layui.form.render();
        }

        // 删除房间
        $("button[id='delete']").click(function () {
            layer.open({
                content: '确定删除吗？'
                ,btn: ['删除', '取消']
                ,yes: function(index, layero){ //删除
                    layer.closeAll(); //关闭所有窗口
                    deleteData(sessionStorage.getItem("R_num"));
                }
                ,btn2: function(index, layero){
                }
                ,cancel: function(){
                }
            });
        });

        // 根据房间编号删除相应的类型
        function deleteData(R_num) {
            $.ajax({
                url: "/DeleteRoomByRN",
                type:'post',
                data:{R_num:R_num},
                dataType:'text',
                success: function(data){
                    // 后台删除失败
                    if(data != 1) {
                        showResult("1删除失败！");
                    } else {
                        showResult("删除成功！");
                    }
                },
                error: function () {
                    showResult("2删除失败！");
                }
            });
        }

    });

</script>


</body>

</html>
